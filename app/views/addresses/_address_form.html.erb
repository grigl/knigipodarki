<%= form_for @address do |form| %>
<div class="formset">
  <!-- .fields -->
    <div class="fields">
      <% if @address.user_id.nil? %>
        <%= form.hidden_field :user_id, value: current_user.id %>
      <% end %>
      <fieldset>
        <%= form.label :lastname, 'Фамилия' %>
        <%= form.text_field :lastname, :class => 'required' %>
        <% if @address.errors[:lastname].present? %>
        	<div><%= @address.errors[:lastname][0] %></div>
        <% end %>        
      </fieldset>
      <fieldset>
        <%= form.label :firstname, 'Имя' %>
        <%= form.text_field :firstname, :class => 'required' %>
        <% if @address.errors[:firstname].present? %>
        	<div><%= @address.errors[:firstname][0] %></div>
        <% end %>
      </fieldset>
      <fieldset>
        <%= form.label :secondname, 'Отчество' %>
        <%= form.text_field :secondname %>
        <% if @address.errors[:secondname].present? %>
        	<div><%= @address.errors[:secondname][0] %></div>
        <% end %>        
      </fieldset>
      <fieldset>
        <%= form.label :country_id, 'Страна' %>
        <%= form.collection_select :country_id, available_countries, :id, :name, {}, {:ass => 'required'} %>
        <% if @address.errors[:country_id].present? %>
        	<div><%= @address.errors[:country_id][0] %></div>
        <% end %>        
      </fieldset>
      <fieldset>
        <% have_states = !@address.country.states.empty? %>
          <%= form.label :state, 'Регион/область' %>
          <noscript>
            <%= form.text_field :state_name, :class => 'required' %>
          </noscript>
          <% state_elements = [
                form.collection_select(:state_id, @address.country.states,
                                  :id, :name,
                                  {:include_blank => 'Выберите область'},
                                  {:class => have_states ? "required" : "hidden",
                                  :disabled => !have_states}) +
                form.text_field(:state_name,
                                  :class => !have_states ? "required" : "hidden",
                                  :disabled => have_states)
              ].join.gsub('"', "'").gsub("\n", "")
          %>
          <script type="text/javascript" language="javascript" charset="utf-8">
          // <![CDATA[
          document.write("<%== state_elements %>");
          $(function() {
          	$('#address_state_id').change(function() {
          		var val = $('#address_state_id option:selected').val();
          		if (val == 77 || val == 78) {
          			$('#address_city').val($('#address_state_id option:selected').text());
          		}
          	});
          });          
          // ]]>
          </script>
        <% if @address.errors[:state].present? %>
        	<div><%= @address.errors[:state][0] %></div>
        <% end %>          
      </fieldset>
    </div>
    <!-- /.fields -->
    <!-- .fields -->
    <div class="fields">
      <fieldset>
        <%= form.label :city, 'Город' %>
        <%= form.text_field :city, :class => 'required' %>
        <% if @address.errors[:city].present? %>
        	<div><%= @address.errors[:city][0] %></div>
        <% end %>        
      </fieldset>
      <fieldset>
        <%= form.label :zipcode, 'Индекс' %>
        <%= form.text_field :zipcode, :class => 'required postal_mask' %>
        <% if @address.errors[:zipcode].present? %>
        	<div><%= @address.errors[:zipcode][0] %></div>
        <% end %>        
      </fieldset>
      <fieldset>
        <%= form.label :address1, 'Адрес' %>
        <%= form.text_field :address1, :class => 'required' %>
        <% if @address.errors[:address1].present? %>
        	<div><%= @address.errors[:address1][0] %></div>
        <% end %>        
      </fieldset>
      <fieldset>
        <%= form.label :phone, 'Телефон' %>
        <%= form.text_field :phone, :class => 'required phone_mask' %>
        <% if @address.errors[:phone].present? %>
        	<div><%= @address.errors[:phone][0] %></div>
        <% end %>        
      </fieldset>
    </div>
    <!-- /.fields -->

  </div>
  <!-- .controls -->
  <div class="controls controls-big top-decor">
    <%= link_to 'Отмена', account_path %>
    <input type="submit" value="Сохранить">
  </div>
  <!-- /.controls -->
<% end %>